{
  "protocol": "SystemGOD-IPC",
  "version": "1.0.0",
  "transport": "stdin/stdout",
  "encoding": "utf-8",
  "framing": "json-lines",
  "description": "Contract between backend and frontend (Python/Electron",

  "rules": {
    "one_message_per_line": true,
    "json_only": true,
    "stateless_python_ui": true,
    "session_isolation": true,
    "correlation_by_id": true,
    "non_blocking": true
  },

  "entities": {
    "session": {
      "id": "string",
      "shell": "cmd | powershell | bash",
      "cwd": "string",
      "process": "internal",
      "lifecycle": ["idle", "running", "terminating"]
    }
  },

  "requests": {
    "base": {
      "action": "string",
      "id": "string",
      "meta": "object (optional)"
    },

    "run": {
      "action": "run",
      "id": "session-id",
      "shell": "cmd | powershell | bash",
      "command": "string",
      "cwd": "string (optional)"
    },

    "kill": {
      "action": "kill",
      "id": "session-id"
    },

    "destroy": {
      "action": "destroy",
      "id": "session-id"
    },

    "ping": {
      "action": "ping"
    },

    "tool": {
      "action": "tool",
      "tool": "search | llm | analyze",
      "query": "string",
      "options": "object (optional)"
    }
  },

  "responses": {
    "start": {
      "type": "start",
      "id": "session-id",
      "pid": "number"
    },

    "stdout": {
      "type": "stdout",
      "id": "session-id",
      "data": "string"
    },

    "stderr": {
      "type": "stderr",
      "id": "session-id",
      "data": "string"
    },

    "cwd_update": {
      "type": "cwd_update",
      "id": "session-id",
      "data": "string"
    },

    "close": {
      "type": "close",
      "id": "session-id",
      "code": "number"
    },

    "error": {
      "type": "error",
      "id": "session-id",
      "data": "string"
    },

    "pong": {
      "type": "pong",
      "data": "alive"
    },

    "log": {
      "type": "log",
      "level": "info | warn | error",
      "source": "executor | system | tool",
      "data": "string"
    }
  },

  "state_machine": {
    "idle": {
      "on": {
        "run": "running"
      }
    },
    "running": {
      "on": {
        "stdout": "running",
        "stderr": "running",
        "kill": "terminating",
        "close": "idle"
      }
    },
    "terminating": {
      "on": {
        "close": "idle"
      }
    }
  },

  "guarantees": {
    "stdout_and_stderr_streamed": true,
    "process_per_session": true,
    "kill_is_scoped": true,
    "cwd_is_session_scoped": true,
    "crash_does_not_kill_other_sessions": true
  },

  "future_extensions": {
    "search_engine": ["brave", "duckduckgo"],
    "llm": ["ollama", "llama.cpp"],
    "transport": ["websocket", "unix-socket"],
    "logging": ["structured-json", "file-backend"]
  }
}
